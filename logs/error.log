{"asctime": "2025-08-29 05:34:56,777", "levelname": "ERROR", "name": "app.utils.permission_checker", "funcName": "validate_user_session", "lineno": 344, "message": "Session validation error", "event_type": "session_validation_error", "user_id": "b013e98f-b766-4041-af95-92787fa0e030", "error": "SessionManager() takes no arguments", "timestamp": "2025-08-29T05:34:56.780566Z", "environment": "development", "request_id": "fe997bfb-f8bb-460e-941f-3558c3aef294", "service": "blood-bank-api"}
{"asctime": "2025-08-29 07:42:06,407", "levelname": "ERROR", "name": "app.utils.permission_checker", "funcName": "validate_user_session", "lineno": 304, "message": "Session validation error", "event_type": "session_validation_error", "user_id": "b013e98f-b766-4041-af95-92787fa0e030", "error": "SessionManager() takes no arguments", "timestamp": "2025-08-29T07:42:06.407962Z", "environment": "development", "request_id": "684a61cc-af0d-45ef-beca-152629d66147", "service": "blood-bank-api"}
{"asctime": "2025-08-29 07:42:52,336", "levelname": "ERROR", "name": "app.utils.permission_checker", "funcName": "validate_user_session", "lineno": 304, "message": "Session validation error", "event_type": "session_validation_error", "user_id": "b013e98f-b766-4041-af95-92787fa0e030", "error": "SessionManager() takes no arguments", "timestamp": "2025-08-29T07:42:52.336851Z", "environment": "development", "request_id": "86015d88-5fe6-4aa3-bb87-5d6effe3b5b6", "service": "blood-bank-api"}
{"asctime": "2025-08-29 07:43:38,314", "levelname": "ERROR", "name": "app.utils.permission_checker", "funcName": "validate_user_session", "lineno": 304, "message": "Session validation error", "event_type": "session_validation_error", "user_id": "b013e98f-b766-4041-af95-92787fa0e030", "error": "SessionManager() takes no arguments", "timestamp": "2025-08-29T07:43:38.316256Z", "environment": "development", "request_id": "3ab1ada2-a104-44f1-8525-0a7ca7746c56", "service": "blood-bank-api"}
{"asctime": "2025-08-29 07:43:57,892", "levelname": "ERROR", "name": "app.utils.permission_checker", "funcName": "validate_user_session", "lineno": 304, "message": "Session validation error", "event_type": "session_validation_error", "user_id": "b013e98f-b766-4041-af95-92787fa0e030", "error": "SessionManager() takes no arguments", "timestamp": "2025-08-29T07:43:57.892801Z", "environment": "development", "request_id": "7e443e30-84d3-45df-a28d-a96c6201ef60", "service": "blood-bank-api"}
{"asctime": "2025-08-29 07:45:22,234", "levelname": "ERROR", "name": "app.utils.permission_checker", "funcName": "validate_user_session", "lineno": 304, "message": "Session validation error", "event_type": "session_validation_error", "user_id": "b013e98f-b766-4041-af95-92787fa0e030", "error": "SessionManager() takes no arguments", "timestamp": "2025-08-29T07:45:22.234888Z", "environment": "development", "request_id": "352e0db5-b0db-45be-baa5-69186e8415b2", "service": "blood-bank-api"}
{"asctime": "2025-08-29 07:45:34,587", "levelname": "ERROR", "name": "app.utils.permission_checker", "funcName": "validate_user_session", "lineno": 304, "message": "Session validation error", "event_type": "session_validation_error", "user_id": "b013e98f-b766-4041-af95-92787fa0e030", "error": "SessionManager() takes no arguments", "timestamp": "2025-08-29T07:45:34.588484Z", "environment": "development", "request_id": "c924adf5-fa35-4da2-b187-1e1e9943d1df", "service": "blood-bank-api"}
{"asctime": "2025-08-29 07:49:55,672", "levelname": "ERROR", "name": "app.utils.permission_checker", "funcName": "validate_user_session", "lineno": 304, "message": "Session validation error", "event_type": "session_validation_error", "user_id": "b013e98f-b766-4041-af95-92787fa0e030", "error": "SessionManager() takes no arguments", "timestamp": "2025-08-29T07:49:55.672852Z", "environment": "development", "request_id": "42d874e7-2d4d-4337-95a4-4b80cf98fe37", "service": "blood-bank-api"}
{"asctime": "2025-08-29 11:32:01,176", "levelname": "ERROR", "name": "app.utils.permission_checker", "funcName": "validate_user_session", "lineno": 305, "message": "Session validation error", "event_type": "session_validation_error", "user_id": "b013e98f-b766-4041-af95-92787fa0e030", "error": "SessionManager.validate_session() got an unexpected keyword argument 'user_id'", "timestamp": "2025-08-29T11:32:01.177847Z", "environment": "development", "request_id": "06eea8d8-07d4-4e7f-b777-0022f32ee9ff", "service": "blood-bank-api"}
{"asctime": "2025-08-29 11:33:43,959", "levelname": "ERROR", "name": "app.utils.permission_checker", "funcName": "validate_user_session", "lineno": 305, "message": "Session validation error", "event_type": "session_validation_error", "user_id": "b013e98f-b766-4041-af95-92787fa0e030", "error": "SessionManager.validate_session() got an unexpected keyword argument 'user_id'", "timestamp": "2025-08-29T11:33:43.960388Z", "environment": "development", "request_id": "aa424666-97f1-4c0c-8f5d-646186070592", "service": "blood-bank-api"}
{"asctime": "2025-08-29 11:42:47,027", "levelname": "ERROR", "name": "app.utils.permission_checker", "funcName": "validate_user_session", "lineno": 307, "message": "Session validation error", "event_type": "session_validation_error", "user_id": "b013e98f-b766-4041-af95-92787fa0e030", "error": "SessionManager.validate_session() got an unexpected keyword argument 'user_id'", "timestamp": "2025-08-29T11:42:47.028483Z", "environment": "development", "request_id": "58cd5160-456a-4f37-83d7-6dfae50d397c", "service": "blood-bank-api"}
{"asctime": "2025-08-29 11:43:43,052", "levelname": "ERROR", "name": "app.utils.permission_checker", "funcName": "validate_user_session", "lineno": 308, "message": "Session validation error", "event_type": "session_validation_error", "user_id": "b013e98f-b766-4041-af95-92787fa0e030", "error": "SessionManager.validate_session() got an unexpected keyword argument 'user_id'", "timestamp": "2025-08-29T11:43:43.053542Z", "environment": "development", "request_id": "447c3dcd-969a-4d15-86bc-efa14e3a879e", "service": "blood-bank-api"}
{"asctime": "2025-08-29 11:48:06,377", "levelname": "ERROR", "name": "app.utils.permission_checker", "funcName": "validate_user_session", "lineno": 308, "message": "Session validation error", "event_type": "session_validation_error", "user_id": "b013e98f-b766-4041-af95-92787fa0e030", "error": "SessionManager.validate_session() got an unexpected keyword argument 'user_id'", "timestamp": "2025-08-29T11:48:06.378435Z", "environment": "development", "request_id": "c50be2f8-02e3-4140-9962-b053ce380f2e", "service": "blood-bank-api"}
{"asctime": "2025-08-29 11:48:55,822", "levelname": "ERROR", "name": "app.utils.permission_checker", "funcName": "validate_user_session", "lineno": 308, "message": "Session validation error", "event_type": "session_validation_error", "user_id": "b013e98f-b766-4041-af95-92787fa0e030", "error": "SessionManager.validate_session() got an unexpected keyword argument 'user_id'", "timestamp": "2025-08-29T11:48:55.822932Z", "environment": "development", "request_id": "e83522fb-40fa-49d8-a50e-de02b72cd498", "service": "blood-bank-api"}
{"asctime": "2025-08-29 11:49:36,931", "levelname": "ERROR", "name": "app.utils.permission_checker", "funcName": "validate_user_session", "lineno": 308, "message": "Session validation error", "event_type": "session_validation_error", "user_id": "b013e98f-b766-4041-af95-92787fa0e030", "error": "SessionManager.validate_session() got an unexpected keyword argument 'user_id'", "timestamp": "2025-08-29T11:49:36.932483Z", "environment": "development", "request_id": "2770194c-d701-4280-b151-e36012ad88b4", "service": "blood-bank-api"}
{"asctime": "2025-08-29 11:58:22,552", "levelname": "ERROR", "name": "app.utils.permission_checker", "funcName": "validate_user_session", "lineno": 302, "message": "Session validation error", "event_type": "session_validation_error", "user_id": "b013e98f-b766-4041-af95-92787fa0e030", "error": "greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)", "timestamp": "2025-08-29T11:58:22.553246Z", "environment": "development", "request_id": "a5674cd8-a85d-4b79-b24d-d73bf8dd9261", "service": "blood-bank-api"}
{"asctime": "2025-08-29 12:15:16,894", "levelname": "ERROR", "name": "app.utils.permission_checker", "funcName": "validate_user_session", "lineno": 320, "message": "Session validation error", "event_type": "session_validation_error", "user_id": "b013e98f-b766-4041-af95-92787fa0e030", "error": "(builtins.AttributeError) 'str' object has no attribute 'hex'\n[SQL: SELECT user_sessions.id, user_sessions.user_id, user_sessions.session_token, user_sessions.device_fingerprint, user_sessions.user_agent, user_sessions.user_agent_hash, user_sessions.ip_address, user_sessions.country, user_sessions.city, user_sessions.isp, user_sessions.is_active, user_sessions.is_suspicious, user_sessions.created_at, user_sessions.last_activity, user_sessions.expires_at, user_sessions.terminated_at, user_sessions.login_method, user_sessions.risk_score, user_sessions.total_requests \nFROM user_sessions \nWHERE user_sessions.id = ?]\n[parameters: [{}]]", "timestamp": "2025-08-29T12:15:16.895774Z", "environment": "development", "request_id": "dae76ace-eb16-4295-8d81-00ecfe7b3bf0", "service": "blood-bank-api"}
{"asctime": "2025-08-29 13:51:03,127", "levelname": "ERROR", "name": "app.routes.users", "funcName": "get_all_staff_users", "lineno": 991, "message": "Staff list access failed due to unexpected error", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\BARTHOLOMEW\\Desktop\\donorcom\\app\\routes\\users.py\", line 957, in get_all_staff_users\n    staff_users = await user_service.get_all_staff_users(current_user.facility.id)\n                                                         ^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'id'", "event_type": "staff_list_error", "current_user_id": "ddb50fa8-e847-46f6-9271-3dd05bb10fad", "error": "'NoneType' object has no attribute 'id'", "duration_ms": 1.1043548583984375, "timestamp": "2025-08-29T13:51:03.143048Z", "environment": "development", "request_id": "de1bfd7b-b621-480c-b4dd-547168116a68", "user_id": "ddb50fa8-e847-46f6-9271-3dd05bb10fad", "service": "blood-bank-api", "exception": {"type": "AttributeError", "message": "'NoneType' object has no attribute 'id'", "traceback": ["Traceback (most recent call last):\n", "  File \"C:\\Users\\BARTHOLOMEW\\Desktop\\donorcom\\app\\routes\\users.py\", line 957, in get_all_staff_users\n    staff_users = await user_service.get_all_staff_users(current_user.facility.id)\n                                                         ^^^^^^^^^^^^^^^^^^^^^^^^\n", "AttributeError: 'NoneType' object has no attribute 'id'\n"]}}
{"asctime": "2025-08-29 14:09:39,672", "levelname": "ERROR", "name": "app.middlewares.logging_middleware", "funcName": "dispatch", "lineno": 141, "message": "Request failed: GET /api/users/auth/refresh", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\middleware\\base.py\", line 147, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\anyio\\streams\\memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"C:\\Users\\BARTHOLOMEW\\Desktop\\donorcom\\app\\middlewares\\logging_middleware.py\", line 75, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\middleware\\base.py\", line 153, in call_next\n    raise app_exc\n  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\middleware\\base.py\", line 140, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\middleware\\cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\middleware\\base.py\", line 173, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"C:\\Program Files\\WindowsApps\\PythonSoftwareFoundation.Python.3.13_3.13.2032.0_x64__qbz5n2kfra8p0\\Lib\\contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\_utils.py\", line 82, in collapse_excgroups\n    raise exc\n  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\middleware\\base.py\", line 175, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Users\\BARTHOLOMEW\\Desktop\\donorcom\\app\\main.py\", line 73, in https_redirect\n    return await call_next(request)\n           ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\middleware\\base.py\", line 153, in call_next\n    raise app_exc\n  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\middleware\\base.py\", line 140, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\middleware\\exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\routing.py\", line 714, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\routing.py\", line 734, in app\n    await route.handle(scope, receive, send)\n  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\routing.py\", line 288, in handle\n    await self.app(scope, receive, send)\n  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\routing.py\", line 76, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\routing.py\", line 73, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\fastapi\\routing.py\", line 301, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<3 lines>...\n    )\n    ^\n  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\fastapi\\routing.py\", line 212, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Users\\BARTHOLOMEW\\Desktop\\donorcom\\app\\routes\\auth.py\", line 247, in refresh_token\n    session_data = await SessionManager.extract_device_info(request)\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object dict can't be used in 'await' expression", "extra_fields": {"http_method": "GET", "path": "/api/users/auth/refresh", "error_type": "TypeError", "error_message": "object dict can't be used in 'await' expression", "response_time_seconds": 0.056, "client_ip": "127.0.0.1", "action": "request_failed"}, "timestamp": "2025-08-29T14:09:39.987511Z", "environment": "development", "request_id": "e047d309-49a9-4478-93f3-d1b72fbfd15c", "service": "blood-bank-api", "exception": {"type": "TypeError", "message": "object dict can't be used in 'await' expression", "traceback": ["Traceback (most recent call last):\n", "  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\middleware\\base.py\", line 147, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\anyio\\streams\\memory.py\", line 126, in receive\n    raise EndOfStream from None\n", "anyio.EndOfStream\n", "\nDuring handling of the above exception, another exception occurred:\n\n", "Traceback (most recent call last):\n", "  File \"C:\\Users\\BARTHOLOMEW\\Desktop\\donorcom\\app\\middlewares\\logging_middleware.py\", line 75, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\middleware\\base.py\", line 153, in call_next\n    raise app_exc\n", "  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\middleware\\base.py\", line 140, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n", "  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\middleware\\cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n", "  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\middleware\\base.py\", line 173, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n", "  File \"C:\\Program Files\\WindowsApps\\PythonSoftwareFoundation.Python.3.13_3.13.2032.0_x64__qbz5n2kfra8p0\\Lib\\contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n", "  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\_utils.py\", line 82, in collapse_excgroups\n    raise exc\n", "  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\middleware\\base.py\", line 175, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"C:\\Users\\BARTHOLOMEW\\Desktop\\donorcom\\app\\main.py\", line 73, in https_redirect\n    return await call_next(request)\n           ^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\middleware\\base.py\", line 153, in call_next\n    raise app_exc\n", "  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\middleware\\base.py\", line 140, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n", "  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\middleware\\exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n", "  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n", "  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n", "  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\routing.py\", line 714, in __call__\n    await self.middleware_stack(scope, receive, send)\n", "  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\routing.py\", line 734, in app\n    await route.handle(scope, receive, send)\n", "  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\routing.py\", line 288, in handle\n    await self.app(scope, receive, send)\n", "  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\routing.py\", line 76, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n", "  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n", "  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n", "  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\routing.py\", line 73, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n", "  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\fastapi\\routing.py\", line 301, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<3 lines>...\n    )\n    ^\n", "  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\fastapi\\routing.py\", line 212, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"C:\\Users\\BARTHOLOMEW\\Desktop\\donorcom\\app\\routes\\auth.py\", line 247, in refresh_token\n    session_data = await SessionManager.extract_device_info(request)\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "TypeError: object dict can't be used in 'await' expression\n"]}, "http_method": "GET", "path": "/api/users/auth/refresh", "error_type": "TypeError", "error_message": "object dict can't be used in 'await' expression", "response_time_seconds": 0.056, "client_ip": "127.0.0.1", "action": "request_failed"}
{"asctime": "2025-08-29 16:21:14,320", "levelname": "ERROR", "name": "app.routes.auth", "funcName": "async_wrapper", "lineno": 279, "message": "Error in login: 400: Invalid email or password", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\BARTHOLOMEW\\Desktop\\donorcom\\app\\utils\\logging_config.py\", line 251, in async_wrapper\n    result = await func(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Users\\BARTHOLOMEW\\Desktop\\donorcom\\app\\routes\\auth.py\", line 140, in login\n    raise HTTPException(status_code=400, detail=error_message)\nfastapi.exceptions.HTTPException: 400: Invalid email or password", "extra_fields": {"function": "login", "module": "app.routes.auth", "action": "function_error", "execution_time_seconds": 0.0697, "status": "error", "error_type": "HTTPException", "error_message": "400: Invalid email or password"}, "timestamp": "2025-08-29T16:21:14.376063Z", "environment": "development", "request_id": "d42e221e-525c-4017-9ca6-cdd86482dcac", "service": "blood-bank-api", "exception": {"type": "HTTPException", "message": "400: Invalid email or password", "traceback": ["Traceback (most recent call last):\n", "  File \"C:\\Users\\BARTHOLOMEW\\Desktop\\donorcom\\app\\utils\\logging_config.py\", line 251, in async_wrapper\n    result = await func(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"C:\\Users\\BARTHOLOMEW\\Desktop\\donorcom\\app\\routes\\auth.py\", line 140, in login\n    raise HTTPException(status_code=400, detail=error_message)\n", "fastapi.exceptions.HTTPException: 400: Invalid email or password\n"]}, "function": "login", "module": "app.routes.auth", "action": "function_error", "execution_time_seconds": 0.0697, "status": "error", "error_type": "HTTPException", "error_message": "400: Invalid email or password"}
{"asctime": "2025-08-29 16:23:20,106", "levelname": "ERROR", "name": "app.routes.auth", "funcName": "async_wrapper", "lineno": 279, "message": "Error in login: 400: Invalid email or password", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\BARTHOLOMEW\\Desktop\\donorcom\\app\\utils\\logging_config.py\", line 251, in async_wrapper\n    result = await func(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Users\\BARTHOLOMEW\\Desktop\\donorcom\\app\\routes\\auth.py\", line 140, in login\n    raise HTTPException(status_code=400, detail=error_message)\nfastapi.exceptions.HTTPException: 400: Invalid email or password", "extra_fields": {"function": "login", "module": "app.routes.auth", "action": "function_error", "execution_time_seconds": 0.0081, "status": "error", "error_type": "HTTPException", "error_message": "400: Invalid email or password"}, "timestamp": "2025-08-29T16:23:20.112800Z", "environment": "development", "request_id": "f2dfa6ed-694e-4447-ae2e-184943d5b90d", "service": "blood-bank-api", "exception": {"type": "HTTPException", "message": "400: Invalid email or password", "traceback": ["Traceback (most recent call last):\n", "  File \"C:\\Users\\BARTHOLOMEW\\Desktop\\donorcom\\app\\utils\\logging_config.py\", line 251, in async_wrapper\n    result = await func(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"C:\\Users\\BARTHOLOMEW\\Desktop\\donorcom\\app\\routes\\auth.py\", line 140, in login\n    raise HTTPException(status_code=400, detail=error_message)\n", "fastapi.exceptions.HTTPException: 400: Invalid email or password\n"]}, "function": "login", "module": "app.routes.auth", "action": "function_error", "execution_time_seconds": 0.0081, "status": "error", "error_type": "HTTPException", "error_message": "400: Invalid email or password"}
{"asctime": "2025-08-29 16:24:37,799", "levelname": "ERROR", "name": "facility_gps", "funcName": "fetch_and_update_facilities", "lineno": 93, "message": "Error updating facility coordinates: 'NoneType' object is not subscriptable", "timestamp": "2025-08-29T16:24:37.800536Z", "environment": "development", "service": "blood-bank-api"}
{"asctime": "2025-08-29 16:26:31,199", "levelname": "ERROR", "name": "app.routes.facility", "funcName": "get_facility_by_id", "lineno": 392, "message": "Facility retrieval failed due to unexpected error", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\BARTHOLOMEW\\Desktop\\donorcom\\app\\routes\\facility.py\", line 366, in get_facility_by_id\n    \"facility_name\": facility.name,\n                     ^^^^^^^^^^^^^\nAttributeError: 'Facility' object has no attribute 'name'", "event_type": "facility_retrieval_error", "facility_id": "8795266d-4f8d-4f5b-b2d0-794c60083c3c", "error": "'Facility' object has no attribute 'name'", "duration_ms": 13.454914093017578, "timestamp": "2025-08-29T16:26:31.230719Z", "environment": "development", "request_id": "1528076f-1f4f-4b47-b976-c1ac87fbff42", "user_id": "96b1e086-6340-4005-bced-dd85be2a380d", "service": "blood-bank-api", "exception": {"type": "AttributeError", "message": "'Facility' object has no attribute 'name'", "traceback": ["Traceback (most recent call last):\n", "  File \"C:\\Users\\BARTHOLOMEW\\Desktop\\donorcom\\app\\routes\\facility.py\", line 366, in get_facility_by_id\n    \"facility_name\": facility.name,\n                     ^^^^^^^^^^^^^\n", "AttributeError: 'Facility' object has no attribute 'name'\n"]}}
{"asctime": "2025-08-29 16:30:41,010", "levelname": "ERROR", "name": "app.routes.facility", "funcName": "update_facility", "lineno": 630, "message": "Facility update failed due to unexpected error", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\BARTHOLOMEW\\Desktop\\donorcom\\app\\routes\\facility.py\", line 553, in update_facility\n    \"name\": existing_facility.name,\n            ^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'Facility' object has no attribute 'name'", "event_type": "facility_update_error", "facility_id": "8795266d-4f8d-4f5b-b2d0-794c60083c3c", "current_user_id": "96b1e086-6340-4005-bced-dd85be2a380d", "error": "'Facility' object has no attribute 'name'", "duration_ms": 6.28209114074707, "timestamp": "2025-08-29T16:30:41.016646Z", "environment": "development", "request_id": "cbb32af8-617d-492a-a955-9710fe4b81b5", "user_id": "96b1e086-6340-4005-bced-dd85be2a380d", "service": "blood-bank-api", "exception": {"type": "AttributeError", "message": "'Facility' object has no attribute 'name'", "traceback": ["Traceback (most recent call last):\n", "  File \"C:\\Users\\BARTHOLOMEW\\Desktop\\donorcom\\app\\routes\\facility.py\", line 553, in update_facility\n    \"name\": existing_facility.name,\n            ^^^^^^^^^^^^^^^^^^^^^^\n", "AttributeError: 'Facility' object has no attribute 'name'\n"]}}
{"asctime": "2025-08-29 16:30:41,018", "levelname": "ERROR", "name": "app.routes.facility", "funcName": "async_wrapper", "lineno": 279, "message": "Error in update_facility: 500: Facility update failed", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\BARTHOLOMEW\\Desktop\\donorcom\\app\\routes\\facility.py\", line 553, in update_facility\n    \"name\": existing_facility.name,\n            ^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'Facility' object has no attribute 'name'\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"C:\\Users\\BARTHOLOMEW\\Desktop\\donorcom\\app\\utils\\logging_config.py\", line 251, in async_wrapper\n    result = await func(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Users\\BARTHOLOMEW\\Desktop\\donorcom\\app\\routes\\facility.py\", line 654, in update_facility\n    raise HTTPException(status_code=500, detail=\"Facility update failed\")\nfastapi.exceptions.HTTPException: 500: Facility update failed", "extra_fields": {"function": "update_facility", "module": "app.routes.facility", "action": "function_error", "execution_time_seconds": 0.015, "status": "error", "error_type": "HTTPException", "error_message": "500: Facility update failed"}, "timestamp": "2025-08-29T16:30:41.029885Z", "environment": "development", "request_id": "cbb32af8-617d-492a-a955-9710fe4b81b5", "user_id": "96b1e086-6340-4005-bced-dd85be2a380d", "service": "blood-bank-api", "exception": {"type": "HTTPException", "message": "500: Facility update failed", "traceback": ["Traceback (most recent call last):\n", "  File \"C:\\Users\\BARTHOLOMEW\\Desktop\\donorcom\\app\\routes\\facility.py\", line 553, in update_facility\n    \"name\": existing_facility.name,\n            ^^^^^^^^^^^^^^^^^^^^^^\n", "AttributeError: 'Facility' object has no attribute 'name'\n", "\nDuring handling of the above exception, another exception occurred:\n\n", "Traceback (most recent call last):\n", "  File \"C:\\Users\\BARTHOLOMEW\\Desktop\\donorcom\\app\\utils\\logging_config.py\", line 251, in async_wrapper\n    result = await func(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"C:\\Users\\BARTHOLOMEW\\Desktop\\donorcom\\app\\routes\\facility.py\", line 654, in update_facility\n    raise HTTPException(status_code=500, detail=\"Facility update failed\")\n", "fastapi.exceptions.HTTPException: 500: Facility update failed\n"]}, "function": "update_facility", "module": "app.routes.facility", "action": "function_error", "execution_time_seconds": 0.015, "status": "error", "error_type": "HTTPException", "error_message": "500: Facility update failed"}
{"asctime": "2025-08-29 16:46:24,196", "levelname": "ERROR", "name": "app.routes.facility", "funcName": "async_wrapper", "lineno": 279, "message": "Error in create_facility_with_blood_bank: 'FacilityWithBloodBankCreate' object has no attribute 'facility'", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\BARTHOLOMEW\\Desktop\\donorcom\\app\\utils\\logging_config.py\", line 251, in async_wrapper\n    result = await func(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Users\\BARTHOLOMEW\\Desktop\\donorcom\\app\\routes\\facility.py\", line 184, in create_facility_with_blood_bank\n    \"facility_name\": data.facility.facility_name,\n                     ^^^^^^^^^^^^^\n  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\pydantic\\main.py\", line 984, in __getattr__\n    raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}')\nAttributeError: 'FacilityWithBloodBankCreate' object has no attribute 'facility'", "extra_fields": {"function": "create_facility_with_blood_bank", "module": "app.routes.facility", "action": "function_error", "execution_time_seconds": 0.0009, "status": "error", "error_type": "AttributeError", "error_message": "'FacilityWithBloodBankCreate' object has no attribute 'facility'"}, "timestamp": "2025-08-29T16:46:26.535579Z", "environment": "development", "request_id": "a4a2e69a-29e1-4529-9480-732538e0a9ed", "user_id": "dfa68a60-9a4f-4d5a-a0c6-e72a03b1a3d1", "service": "blood-bank-api", "exception": {"type": "AttributeError", "message": "'FacilityWithBloodBankCreate' object has no attribute 'facility'", "traceback": ["Traceback (most recent call last):\n", "  File \"C:\\Users\\BARTHOLOMEW\\Desktop\\donorcom\\app\\utils\\logging_config.py\", line 251, in async_wrapper\n    result = await func(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"C:\\Users\\BARTHOLOMEW\\Desktop\\donorcom\\app\\routes\\facility.py\", line 184, in create_facility_with_blood_bank\n    \"facility_name\": data.facility.facility_name,\n                     ^^^^^^^^^^^^^\n", "  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\pydantic\\main.py\", line 984, in __getattr__\n    raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}')\n", "AttributeError: 'FacilityWithBloodBankCreate' object has no attribute 'facility'\n"]}, "function": "create_facility_with_blood_bank", "module": "app.routes.facility", "action": "function_error", "execution_time_seconds": 0.0009, "status": "error", "error_type": "AttributeError", "error_message": "'FacilityWithBloodBankCreate' object has no attribute 'facility'"}
{"asctime": "2025-08-29 16:46:26,559", "levelname": "ERROR", "name": "app.middlewares.logging_middleware", "funcName": "dispatch", "lineno": 141, "message": "Request failed: POST /api/facilities/create-with-blood-bank", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\middleware\\base.py\", line 147, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\anyio\\streams\\memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"C:\\Users\\BARTHOLOMEW\\Desktop\\donorcom\\app\\middlewares\\logging_middleware.py\", line 75, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\middleware\\base.py\", line 153, in call_next\n    raise app_exc\n  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\middleware\\base.py\", line 140, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\middleware\\cors.py\", line 93, in __call__\n    await self.simple_response(scope, receive, send, request_headers=headers)\n  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\middleware\\cors.py\", line 144, in simple_response\n    await self.app(scope, receive, send)\n  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\middleware\\base.py\", line 173, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"C:\\Program Files\\WindowsApps\\PythonSoftwareFoundation.Python.3.13_3.13.2032.0_x64__qbz5n2kfra8p0\\Lib\\contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\_utils.py\", line 82, in collapse_excgroups\n    raise exc\n  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\middleware\\base.py\", line 175, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Users\\BARTHOLOMEW\\Desktop\\donorcom\\app\\main.py\", line 73, in https_redirect\n    return await call_next(request)\n           ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\middleware\\base.py\", line 153, in call_next\n    raise app_exc\n  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\middleware\\base.py\", line 140, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\middleware\\exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\routing.py\", line 714, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\routing.py\", line 734, in app\n    await route.handle(scope, receive, send)\n  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\routing.py\", line 288, in handle\n    await self.app(scope, receive, send)\n  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\routing.py\", line 76, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\routing.py\", line 73, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\fastapi\\routing.py\", line 301, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<3 lines>...\n    )\n    ^\n  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\fastapi\\routing.py\", line 212, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Users\\BARTHOLOMEW\\Desktop\\donorcom\\app\\utils\\logging_config.py\", line 251, in async_wrapper\n    result = await func(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Users\\BARTHOLOMEW\\Desktop\\donorcom\\app\\routes\\facility.py\", line 184, in create_facility_with_blood_bank\n    \"facility_name\": data.facility.facility_name,\n                     ^^^^^^^^^^^^^\n  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\pydantic\\main.py\", line 984, in __getattr__\n    raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}')\nAttributeError: 'FacilityWithBloodBankCreate' object has no attribute 'facility'", "extra_fields": {"http_method": "POST", "path": "/api/facilities/create-with-blood-bank", "error_type": "AttributeError", "error_message": "'FacilityWithBloodBankCreate' object has no attribute 'facility'", "response_time_seconds": 2.8376, "client_ip": "127.0.0.1", "action": "request_failed"}, "timestamp": "2025-08-29T16:46:26.718290Z", "environment": "development", "request_id": "a4a2e69a-29e1-4529-9480-732538e0a9ed", "user_id": "dfa68a60-9a4f-4d5a-a0c6-e72a03b1a3d1", "service": "blood-bank-api", "exception": {"type": "AttributeError", "message": "'FacilityWithBloodBankCreate' object has no attribute 'facility'", "traceback": ["Traceback (most recent call last):\n", "  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\middleware\\base.py\", line 147, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\anyio\\streams\\memory.py\", line 126, in receive\n    raise EndOfStream from None\n", "anyio.EndOfStream\n", "\nDuring handling of the above exception, another exception occurred:\n\n", "Traceback (most recent call last):\n", "  File \"C:\\Users\\BARTHOLOMEW\\Desktop\\donorcom\\app\\middlewares\\logging_middleware.py\", line 75, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\middleware\\base.py\", line 153, in call_next\n    raise app_exc\n", "  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\middleware\\base.py\", line 140, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n", "  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\middleware\\cors.py\", line 93, in __call__\n    await self.simple_response(scope, receive, send, request_headers=headers)\n", "  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\middleware\\cors.py\", line 144, in simple_response\n    await self.app(scope, receive, send)\n", "  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\middleware\\base.py\", line 173, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n", "  File \"C:\\Program Files\\WindowsApps\\PythonSoftwareFoundation.Python.3.13_3.13.2032.0_x64__qbz5n2kfra8p0\\Lib\\contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n", "  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\_utils.py\", line 82, in collapse_excgroups\n    raise exc\n", "  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\middleware\\base.py\", line 175, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"C:\\Users\\BARTHOLOMEW\\Desktop\\donorcom\\app\\main.py\", line 73, in https_redirect\n    return await call_next(request)\n           ^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\middleware\\base.py\", line 153, in call_next\n    raise app_exc\n", "  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\middleware\\base.py\", line 140, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n", "  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\middleware\\exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n", "  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n", "  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n", "  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\routing.py\", line 714, in __call__\n    await self.middleware_stack(scope, receive, send)\n", "  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\routing.py\", line 734, in app\n    await route.handle(scope, receive, send)\n", "  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\routing.py\", line 288, in handle\n    await self.app(scope, receive, send)\n", "  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\routing.py\", line 76, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n", "  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n", "  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n", "  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\routing.py\", line 73, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n", "  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\fastapi\\routing.py\", line 301, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<3 lines>...\n    )\n    ^\n", "  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\fastapi\\routing.py\", line 212, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"C:\\Users\\BARTHOLOMEW\\Desktop\\donorcom\\app\\utils\\logging_config.py\", line 251, in async_wrapper\n    result = await func(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"C:\\Users\\BARTHOLOMEW\\Desktop\\donorcom\\app\\routes\\facility.py\", line 184, in create_facility_with_blood_bank\n    \"facility_name\": data.facility.facility_name,\n                     ^^^^^^^^^^^^^\n", "  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\pydantic\\main.py\", line 984, in __getattr__\n    raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}')\n", "AttributeError: 'FacilityWithBloodBankCreate' object has no attribute 'facility'\n"]}, "http_method": "POST", "path": "/api/facilities/create-with-blood-bank", "error_type": "AttributeError", "error_message": "'FacilityWithBloodBankCreate' object has no attribute 'facility'", "response_time_seconds": 2.8376, "client_ip": "127.0.0.1", "action": "request_failed"}
{"asctime": "2025-08-29 16:52:54,298", "levelname": "ERROR", "name": "app.routes.facility", "funcName": "async_wrapper", "lineno": 279, "message": "Error in create_facility_with_blood_bank: 400: Facility with this email already exists", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\BARTHOLOMEW\\Desktop\\donorcom\\app\\utils\\logging_config.py\", line 251, in async_wrapper\n    result = await func(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Users\\BARTHOLOMEW\\Desktop\\donorcom\\app\\routes\\facility.py\", line 193, in create_facility_with_blood_bank\n    result = await facility_service.create_facility_with_blood_bank(\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<2 lines>...\n    )\n    ^\n  File \"C:\\Users\\BARTHOLOMEW\\Desktop\\donorcom\\app\\services\\facility_service.py\", line 54, in create_facility_with_blood_bank\n    raise HTTPException(status_code=400, detail=\"Facility with this email already exists\")\nfastapi.exceptions.HTTPException: 400: Facility with this email already exists", "extra_fields": {"function": "create_facility_with_blood_bank", "module": "app.routes.facility", "action": "function_error", "execution_time_seconds": 0.0098, "status": "error", "error_type": "HTTPException", "error_message": "400: Facility with this email already exists"}, "timestamp": "2025-08-29T16:52:54.332170Z", "environment": "development", "request_id": "fed7061e-9939-4550-9332-ae1eba409dbf", "user_id": "dfa68a60-9a4f-4d5a-a0c6-e72a03b1a3d1", "service": "blood-bank-api", "exception": {"type": "HTTPException", "message": "400: Facility with this email already exists", "traceback": ["Traceback (most recent call last):\n", "  File \"C:\\Users\\BARTHOLOMEW\\Desktop\\donorcom\\app\\utils\\logging_config.py\", line 251, in async_wrapper\n    result = await func(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"C:\\Users\\BARTHOLOMEW\\Desktop\\donorcom\\app\\routes\\facility.py\", line 193, in create_facility_with_blood_bank\n    result = await facility_service.create_facility_with_blood_bank(\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<2 lines>...\n    )\n    ^\n", "  File \"C:\\Users\\BARTHOLOMEW\\Desktop\\donorcom\\app\\services\\facility_service.py\", line 54, in create_facility_with_blood_bank\n    raise HTTPException(status_code=400, detail=\"Facility with this email already exists\")\n", "fastapi.exceptions.HTTPException: 400: Facility with this email already exists\n"]}, "function": "create_facility_with_blood_bank", "module": "app.routes.facility", "action": "function_error", "execution_time_seconds": 0.0098, "status": "error", "error_type": "HTTPException", "error_message": "400: Facility with this email already exists"}
{"asctime": "2025-08-29 16:53:44,622", "levelname": "ERROR", "name": "app.routes.facility", "funcName": "create_facility_with_blood_bank", "lineno": 273, "message": "Facility with blood bank creation failed due to unexpected error", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\BARTHOLOMEW\\Desktop\\donorcom\\app\\routes\\facility.py\", line 229, in create_facility_with_blood_bank\n    \"blood_bank_name\": data.blood_bank.get(\"blood_bank_name\")\n                       ^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\pydantic\\main.py\", line 984, in __getattr__\n    raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}')\nAttributeError: 'BloodBankBase' object has no attribute 'get'", "event_type": "facility_with_blood_bank_creation_error", "current_user_id": "dfa68a60-9a4f-4d5a-a0c6-e72a03b1a3d1", "facility_name": "Tamale Teaching Hospital", "error": "'BloodBankBase' object has no attribute 'get'", "duration_ms": 187.03341484069824, "timestamp": "2025-08-29T16:53:44.631526Z", "environment": "development", "request_id": "f32d0270-d3a8-4790-a4f4-3c9acf82b116", "user_id": "dfa68a60-9a4f-4d5a-a0c6-e72a03b1a3d1", "service": "blood-bank-api", "exception": {"type": "AttributeError", "message": "'BloodBankBase' object has no attribute 'get'", "traceback": ["Traceback (most recent call last):\n", "  File \"C:\\Users\\BARTHOLOMEW\\Desktop\\donorcom\\app\\routes\\facility.py\", line 229, in create_facility_with_blood_bank\n    \"blood_bank_name\": data.blood_bank.get(\"blood_bank_name\")\n                       ^^^^^^^^^^^^^^^^^^^\n", "  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\pydantic\\main.py\", line 984, in __getattr__\n    raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}')\n", "AttributeError: 'BloodBankBase' object has no attribute 'get'\n"]}}
{"asctime": "2025-08-29 16:53:44,632", "levelname": "ERROR", "name": "app.routes.facility", "funcName": "async_wrapper", "lineno": 279, "message": "Error in create_facility_with_blood_bank: 'FacilityWithBloodBankCreate' object has no attribute 'facility'", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\BARTHOLOMEW\\Desktop\\donorcom\\app\\routes\\facility.py\", line 229, in create_facility_with_blood_bank\n    \"blood_bank_name\": data.blood_bank.get(\"blood_bank_name\")\n                       ^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\pydantic\\main.py\", line 984, in __getattr__\n    raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}')\nAttributeError: 'BloodBankBase' object has no attribute 'get'\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"C:\\Users\\BARTHOLOMEW\\Desktop\\donorcom\\app\\utils\\logging_config.py\", line 251, in async_wrapper\n    result = await func(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Users\\BARTHOLOMEW\\Desktop\\donorcom\\app\\routes\\facility.py\", line 290, in create_facility_with_blood_bank\n    \"facility_name\": data.facility.facility_name,\n                     ^^^^^^^^^^^^^\n  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\pydantic\\main.py\", line 984, in __getattr__\n    raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}')\nAttributeError: 'FacilityWithBloodBankCreate' object has no attribute 'facility'", "extra_fields": {"function": "create_facility_with_blood_bank", "module": "app.routes.facility", "action": "function_error", "execution_time_seconds": 0.1973, "status": "error", "error_type": "AttributeError", "error_message": "'FacilityWithBloodBankCreate' object has no attribute 'facility'"}, "timestamp": "2025-08-29T16:53:44.645346Z", "environment": "development", "request_id": "f32d0270-d3a8-4790-a4f4-3c9acf82b116", "user_id": "dfa68a60-9a4f-4d5a-a0c6-e72a03b1a3d1", "service": "blood-bank-api", "exception": {"type": "AttributeError", "message": "'FacilityWithBloodBankCreate' object has no attribute 'facility'", "traceback": ["Traceback (most recent call last):\n", "  File \"C:\\Users\\BARTHOLOMEW\\Desktop\\donorcom\\app\\routes\\facility.py\", line 229, in create_facility_with_blood_bank\n    \"blood_bank_name\": data.blood_bank.get(\"blood_bank_name\")\n                       ^^^^^^^^^^^^^^^^^^^\n", "  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\pydantic\\main.py\", line 984, in __getattr__\n    raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}')\n", "AttributeError: 'BloodBankBase' object has no attribute 'get'\n", "\nDuring handling of the above exception, another exception occurred:\n\n", "Traceback (most recent call last):\n", "  File \"C:\\Users\\BARTHOLOMEW\\Desktop\\donorcom\\app\\utils\\logging_config.py\", line 251, in async_wrapper\n    result = await func(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"C:\\Users\\BARTHOLOMEW\\Desktop\\donorcom\\app\\routes\\facility.py\", line 290, in create_facility_with_blood_bank\n    \"facility_name\": data.facility.facility_name,\n                     ^^^^^^^^^^^^^\n", "  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\pydantic\\main.py\", line 984, in __getattr__\n    raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}')\n", "AttributeError: 'FacilityWithBloodBankCreate' object has no attribute 'facility'\n"]}, "function": "create_facility_with_blood_bank", "module": "app.routes.facility", "action": "function_error", "execution_time_seconds": 0.1973, "status": "error", "error_type": "AttributeError", "error_message": "'FacilityWithBloodBankCreate' object has no attribute 'facility'"}
{"asctime": "2025-08-29 16:53:44,651", "levelname": "ERROR", "name": "app.middlewares.logging_middleware", "funcName": "dispatch", "lineno": 141, "message": "Request failed: POST /api/facilities/create-with-blood-bank", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\middleware\\base.py\", line 147, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\anyio\\streams\\memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"C:\\Users\\BARTHOLOMEW\\Desktop\\donorcom\\app\\middlewares\\logging_middleware.py\", line 75, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\middleware\\base.py\", line 153, in call_next\n    raise app_exc\n  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\middleware\\base.py\", line 140, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\middleware\\cors.py\", line 93, in __call__\n    await self.simple_response(scope, receive, send, request_headers=headers)\n  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\middleware\\cors.py\", line 144, in simple_response\n    await self.app(scope, receive, send)\n  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\middleware\\base.py\", line 173, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"C:\\Program Files\\WindowsApps\\PythonSoftwareFoundation.Python.3.13_3.13.2032.0_x64__qbz5n2kfra8p0\\Lib\\contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\_utils.py\", line 82, in collapse_excgroups\n    raise exc\n  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\middleware\\base.py\", line 175, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Users\\BARTHOLOMEW\\Desktop\\donorcom\\app\\main.py\", line 73, in https_redirect\n    return await call_next(request)\n           ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\middleware\\base.py\", line 153, in call_next\n    raise app_exc\n  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\middleware\\base.py\", line 140, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\middleware\\exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\routing.py\", line 714, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\routing.py\", line 734, in app\n    await route.handle(scope, receive, send)\n  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\routing.py\", line 288, in handle\n    await self.app(scope, receive, send)\n  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\routing.py\", line 76, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\routing.py\", line 73, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\fastapi\\routing.py\", line 301, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<3 lines>...\n    )\n    ^\n  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\fastapi\\routing.py\", line 212, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Users\\BARTHOLOMEW\\Desktop\\donorcom\\app\\utils\\logging_config.py\", line 251, in async_wrapper\n    result = await func(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Users\\BARTHOLOMEW\\Desktop\\donorcom\\app\\routes\\facility.py\", line 290, in create_facility_with_blood_bank\n    \"facility_name\": data.facility.facility_name,\n                     ^^^^^^^^^^^^^\n  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\pydantic\\main.py\", line 984, in __getattr__\n    raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}')\nAttributeError: 'FacilityWithBloodBankCreate' object has no attribute 'facility'", "extra_fields": {"http_method": "POST", "path": "/api/facilities/create-with-blood-bank", "error_type": "AttributeError", "error_message": "'FacilityWithBloodBankCreate' object has no attribute 'facility'", "response_time_seconds": 0.4691, "client_ip": "127.0.0.1", "action": "request_failed"}, "timestamp": "2025-08-29T16:53:44.698783Z", "environment": "development", "request_id": "f32d0270-d3a8-4790-a4f4-3c9acf82b116", "user_id": "dfa68a60-9a4f-4d5a-a0c6-e72a03b1a3d1", "service": "blood-bank-api", "exception": {"type": "AttributeError", "message": "'FacilityWithBloodBankCreate' object has no attribute 'facility'", "traceback": ["Traceback (most recent call last):\n", "  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\middleware\\base.py\", line 147, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\anyio\\streams\\memory.py\", line 126, in receive\n    raise EndOfStream from None\n", "anyio.EndOfStream\n", "\nDuring handling of the above exception, another exception occurred:\n\n", "Traceback (most recent call last):\n", "  File \"C:\\Users\\BARTHOLOMEW\\Desktop\\donorcom\\app\\middlewares\\logging_middleware.py\", line 75, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\middleware\\base.py\", line 153, in call_next\n    raise app_exc\n", "  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\middleware\\base.py\", line 140, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n", "  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\middleware\\cors.py\", line 93, in __call__\n    await self.simple_response(scope, receive, send, request_headers=headers)\n", "  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\middleware\\cors.py\", line 144, in simple_response\n    await self.app(scope, receive, send)\n", "  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\middleware\\base.py\", line 173, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n", "  File \"C:\\Program Files\\WindowsApps\\PythonSoftwareFoundation.Python.3.13_3.13.2032.0_x64__qbz5n2kfra8p0\\Lib\\contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n", "  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\_utils.py\", line 82, in collapse_excgroups\n    raise exc\n", "  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\middleware\\base.py\", line 175, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"C:\\Users\\BARTHOLOMEW\\Desktop\\donorcom\\app\\main.py\", line 73, in https_redirect\n    return await call_next(request)\n           ^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\middleware\\base.py\", line 153, in call_next\n    raise app_exc\n", "  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\middleware\\base.py\", line 140, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n", "  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\middleware\\exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n", "  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n", "  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n", "  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\routing.py\", line 714, in __call__\n    await self.middleware_stack(scope, receive, send)\n", "  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\routing.py\", line 734, in app\n    await route.handle(scope, receive, send)\n", "  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\routing.py\", line 288, in handle\n    await self.app(scope, receive, send)\n", "  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\routing.py\", line 76, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n", "  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n", "  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n", "  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\starlette\\routing.py\", line 73, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n", "  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\fastapi\\routing.py\", line 301, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<3 lines>...\n    )\n    ^\n", "  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\fastapi\\routing.py\", line 212, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"C:\\Users\\BARTHOLOMEW\\Desktop\\donorcom\\app\\utils\\logging_config.py\", line 251, in async_wrapper\n    result = await func(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"C:\\Users\\BARTHOLOMEW\\Desktop\\donorcom\\app\\routes\\facility.py\", line 290, in create_facility_with_blood_bank\n    \"facility_name\": data.facility.facility_name,\n                     ^^^^^^^^^^^^^\n", "  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\pydantic\\main.py\", line 984, in __getattr__\n    raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}')\n", "AttributeError: 'FacilityWithBloodBankCreate' object has no attribute 'facility'\n"]}, "http_method": "POST", "path": "/api/facilities/create-with-blood-bank", "error_type": "AttributeError", "error_message": "'FacilityWithBloodBankCreate' object has no attribute 'facility'", "response_time_seconds": 0.4691, "client_ip": "127.0.0.1", "action": "request_failed"}
{"asctime": "2025-08-29 16:54:34,735", "levelname": "ERROR", "name": "app.routes.facility", "funcName": "async_wrapper", "lineno": 279, "message": "Error in create_facility_with_blood_bank: 400: Facility with this email already exists", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\BARTHOLOMEW\\Desktop\\donorcom\\app\\utils\\logging_config.py\", line 251, in async_wrapper\n    result = await func(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Users\\BARTHOLOMEW\\Desktop\\donorcom\\app\\routes\\facility.py\", line 193, in create_facility_with_blood_bank\n    result = await facility_service.create_facility_with_blood_bank(\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<2 lines>...\n    )\n    ^\n  File \"C:\\Users\\BARTHOLOMEW\\Desktop\\donorcom\\app\\services\\facility_service.py\", line 54, in create_facility_with_blood_bank\n    raise HTTPException(status_code=400, detail=\"Facility with this email already exists\")\nfastapi.exceptions.HTTPException: 400: Facility with this email already exists", "extra_fields": {"function": "create_facility_with_blood_bank", "module": "app.routes.facility", "action": "function_error", "execution_time_seconds": 0.0112, "status": "error", "error_type": "HTTPException", "error_message": "400: Facility with this email already exists"}, "timestamp": "2025-08-29T16:54:34.744588Z", "environment": "development", "request_id": "fc4fc05a-3183-4779-a66d-7f1a793f2fb4", "user_id": "dfa68a60-9a4f-4d5a-a0c6-e72a03b1a3d1", "service": "blood-bank-api", "exception": {"type": "HTTPException", "message": "400: Facility with this email already exists", "traceback": ["Traceback (most recent call last):\n", "  File \"C:\\Users\\BARTHOLOMEW\\Desktop\\donorcom\\app\\utils\\logging_config.py\", line 251, in async_wrapper\n    result = await func(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"C:\\Users\\BARTHOLOMEW\\Desktop\\donorcom\\app\\routes\\facility.py\", line 193, in create_facility_with_blood_bank\n    result = await facility_service.create_facility_with_blood_bank(\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<2 lines>...\n    )\n    ^\n", "  File \"C:\\Users\\BARTHOLOMEW\\Desktop\\donorcom\\app\\services\\facility_service.py\", line 54, in create_facility_with_blood_bank\n    raise HTTPException(status_code=400, detail=\"Facility with this email already exists\")\n", "fastapi.exceptions.HTTPException: 400: Facility with this email already exists\n"]}, "function": "create_facility_with_blood_bank", "module": "app.routes.facility", "action": "function_error", "execution_time_seconds": 0.0112, "status": "error", "error_type": "HTTPException", "error_message": "400: Facility with this email already exists"}
{"asctime": "2025-08-29 16:55:22,687", "levelname": "ERROR", "name": "app.routes.facility", "funcName": "create_facility_with_blood_bank", "lineno": 273, "message": "Facility with blood bank creation failed due to unexpected error", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\BARTHOLOMEW\\Desktop\\donorcom\\app\\routes\\facility.py\", line 229, in create_facility_with_blood_bank\n    \"blood_bank_name\": data.blood_bank.get(\"blood_bank_name\")\n                       ^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\pydantic\\main.py\", line 984, in __getattr__\n    raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}')\nAttributeError: 'BloodBankBase' object has no attribute 'get'", "event_type": "facility_with_blood_bank_creation_error", "current_user_id": "dfa68a60-9a4f-4d5a-a0c6-e72a03b1a3d1", "facility_name": "Tamale Teaching Hospital", "error": "'BloodBankBase' object has no attribute 'get'", "duration_ms": 183.0728054046631, "timestamp": "2025-08-29T16:55:22.694016Z", "environment": "development", "request_id": "c219426f-39b7-498f-9950-c95b99a499d8", "user_id": "dfa68a60-9a4f-4d5a-a0c6-e72a03b1a3d1", "service": "blood-bank-api", "exception": {"type": "AttributeError", "message": "'BloodBankBase' object has no attribute 'get'", "traceback": ["Traceback (most recent call last):\n", "  File \"C:\\Users\\BARTHOLOMEW\\Desktop\\donorcom\\app\\routes\\facility.py\", line 229, in create_facility_with_blood_bank\n    \"blood_bank_name\": data.blood_bank.get(\"blood_bank_name\")\n                       ^^^^^^^^^^^^^^^^^^^\n", "  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\pydantic\\main.py\", line 984, in __getattr__\n    raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}')\n", "AttributeError: 'BloodBankBase' object has no attribute 'get'\n"]}}
{"asctime": "2025-08-29 16:55:22,695", "levelname": "ERROR", "name": "app.routes.facility", "funcName": "async_wrapper", "lineno": 279, "message": "Error in create_facility_with_blood_bank: 500: Facility with blood bank creation failed", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\BARTHOLOMEW\\Desktop\\donorcom\\app\\routes\\facility.py\", line 229, in create_facility_with_blood_bank\n    \"blood_bank_name\": data.blood_bank.get(\"blood_bank_name\")\n                       ^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\pydantic\\main.py\", line 984, in __getattr__\n    raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}')\nAttributeError: 'BloodBankBase' object has no attribute 'get'\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"C:\\Users\\BARTHOLOMEW\\Desktop\\donorcom\\app\\utils\\logging_config.py\", line 251, in async_wrapper\n    result = await func(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Users\\BARTHOLOMEW\\Desktop\\donorcom\\app\\routes\\facility.py\", line 297, in create_facility_with_blood_bank\n    raise HTTPException(status_code=500, detail=\"Facility with blood bank creation failed\")\nfastapi.exceptions.HTTPException: 500: Facility with blood bank creation failed", "extra_fields": {"function": "create_facility_with_blood_bank", "module": "app.routes.facility", "action": "function_error", "execution_time_seconds": 0.1924, "status": "error", "error_type": "HTTPException", "error_message": "500: Facility with blood bank creation failed"}, "timestamp": "2025-08-29T16:55:22.707234Z", "environment": "development", "request_id": "c219426f-39b7-498f-9950-c95b99a499d8", "user_id": "dfa68a60-9a4f-4d5a-a0c6-e72a03b1a3d1", "service": "blood-bank-api", "exception": {"type": "HTTPException", "message": "500: Facility with blood bank creation failed", "traceback": ["Traceback (most recent call last):\n", "  File \"C:\\Users\\BARTHOLOMEW\\Desktop\\donorcom\\app\\routes\\facility.py\", line 229, in create_facility_with_blood_bank\n    \"blood_bank_name\": data.blood_bank.get(\"blood_bank_name\")\n                       ^^^^^^^^^^^^^^^^^^^\n", "  File \"C:\\Users\\BARTHOLOMEW\\donorenv\\Lib\\site-packages\\pydantic\\main.py\", line 984, in __getattr__\n    raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}')\n", "AttributeError: 'BloodBankBase' object has no attribute 'get'\n", "\nDuring handling of the above exception, another exception occurred:\n\n", "Traceback (most recent call last):\n", "  File \"C:\\Users\\BARTHOLOMEW\\Desktop\\donorcom\\app\\utils\\logging_config.py\", line 251, in async_wrapper\n    result = await func(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"C:\\Users\\BARTHOLOMEW\\Desktop\\donorcom\\app\\routes\\facility.py\", line 297, in create_facility_with_blood_bank\n    raise HTTPException(status_code=500, detail=\"Facility with blood bank creation failed\")\n", "fastapi.exceptions.HTTPException: 500: Facility with blood bank creation failed\n"]}, "function": "create_facility_with_blood_bank", "module": "app.routes.facility", "action": "function_error", "execution_time_seconds": 0.1924, "status": "error", "error_type": "HTTPException", "error_message": "500: Facility with blood bank creation failed"}
{"asctime": "2025-08-29 16:57:03,068", "levelname": "ERROR", "name": "app.routes.facility", "funcName": "create_facility_with_blood_bank", "lineno": 273, "message": "Facility with blood bank creation failed due to unexpected error", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\BARTHOLOMEW\\Desktop\\donorcom\\app\\routes\\facility.py\", line 229, in create_facility_with_blood_bank\n    \"blood_bank_name\": data.blood_bank[\"blood_bank_name\"]\n                       ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^\nTypeError: 'BloodBankBase' object is not subscriptable", "event_type": "facility_with_blood_bank_creation_error", "current_user_id": "dfa68a60-9a4f-4d5a-a0c6-e72a03b1a3d1", "facility_name": "Tamale Teaching Hospital", "error": "'BloodBankBase' object is not subscriptable", "duration_ms": 147.6736068725586, "timestamp": "2025-08-29T16:57:03.072413Z", "environment": "development", "request_id": "961a8fc3-ae56-44e5-b4d3-8d34aa6d9662", "user_id": "dfa68a60-9a4f-4d5a-a0c6-e72a03b1a3d1", "service": "blood-bank-api", "exception": {"type": "TypeError", "message": "'BloodBankBase' object is not subscriptable", "traceback": ["Traceback (most recent call last):\n", "  File \"C:\\Users\\BARTHOLOMEW\\Desktop\\donorcom\\app\\routes\\facility.py\", line 229, in create_facility_with_blood_bank\n    \"blood_bank_name\": data.blood_bank[\"blood_bank_name\"]\n                       ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^\n", "TypeError: 'BloodBankBase' object is not subscriptable\n"]}}
{"asctime": "2025-08-29 16:57:03,073", "levelname": "ERROR", "name": "app.routes.facility", "funcName": "async_wrapper", "lineno": 279, "message": "Error in create_facility_with_blood_bank: 500: Facility with blood bank creation failed", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\BARTHOLOMEW\\Desktop\\donorcom\\app\\routes\\facility.py\", line 229, in create_facility_with_blood_bank\n    \"blood_bank_name\": data.blood_bank[\"blood_bank_name\"]\n                       ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^\nTypeError: 'BloodBankBase' object is not subscriptable\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"C:\\Users\\BARTHOLOMEW\\Desktop\\donorcom\\app\\utils\\logging_config.py\", line 251, in async_wrapper\n    result = await func(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Users\\BARTHOLOMEW\\Desktop\\donorcom\\app\\routes\\facility.py\", line 297, in create_facility_with_blood_bank\n    raise HTTPException(status_code=500, detail=\"Facility with blood bank creation failed\")\nfastapi.exceptions.HTTPException: 500: Facility with blood bank creation failed", "extra_fields": {"function": "create_facility_with_blood_bank", "module": "app.routes.facility", "action": "function_error", "execution_time_seconds": 0.1544, "status": "error", "error_type": "HTTPException", "error_message": "500: Facility with blood bank creation failed"}, "timestamp": "2025-08-29T16:57:03.083702Z", "environment": "development", "request_id": "961a8fc3-ae56-44e5-b4d3-8d34aa6d9662", "user_id": "dfa68a60-9a4f-4d5a-a0c6-e72a03b1a3d1", "service": "blood-bank-api", "exception": {"type": "HTTPException", "message": "500: Facility with blood bank creation failed", "traceback": ["Traceback (most recent call last):\n", "  File \"C:\\Users\\BARTHOLOMEW\\Desktop\\donorcom\\app\\routes\\facility.py\", line 229, in create_facility_with_blood_bank\n    \"blood_bank_name\": data.blood_bank[\"blood_bank_name\"]\n                       ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^\n", "TypeError: 'BloodBankBase' object is not subscriptable\n", "\nDuring handling of the above exception, another exception occurred:\n\n", "Traceback (most recent call last):\n", "  File \"C:\\Users\\BARTHOLOMEW\\Desktop\\donorcom\\app\\utils\\logging_config.py\", line 251, in async_wrapper\n    result = await func(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"C:\\Users\\BARTHOLOMEW\\Desktop\\donorcom\\app\\routes\\facility.py\", line 297, in create_facility_with_blood_bank\n    raise HTTPException(status_code=500, detail=\"Facility with blood bank creation failed\")\n", "fastapi.exceptions.HTTPException: 500: Facility with blood bank creation failed\n"]}, "function": "create_facility_with_blood_bank", "module": "app.routes.facility", "action": "function_error", "execution_time_seconds": 0.1544, "status": "error", "error_type": "HTTPException", "error_message": "500: Facility with blood bank creation failed"}
{"asctime": "2025-08-29 17:00:24,846", "levelname": "ERROR", "name": "app.routes.facility", "funcName": "async_wrapper", "lineno": 279, "message": "Error in update_facility: 403: Permission denied", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\BARTHOLOMEW\\Desktop\\donorcom\\app\\utils\\logging_config.py\", line 251, in async_wrapper\n    result = await func(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Users\\BARTHOLOMEW\\Desktop\\donorcom\\app\\routes\\facility.py\", line 542, in update_facility\n    raise HTTPException(status_code=403, detail=\"Permission denied\")\nfastapi.exceptions.HTTPException: 403: Permission denied", "extra_fields": {"function": "update_facility", "module": "app.routes.facility", "action": "function_error", "execution_time_seconds": 0.012, "status": "error", "error_type": "HTTPException", "error_message": "403: Permission denied"}, "timestamp": "2025-08-29T17:00:24.853569Z", "environment": "development", "request_id": "8e94f008-5ddc-477f-9c5e-5862cfef01b1", "user_id": "dfa68a60-9a4f-4d5a-a0c6-e72a03b1a3d1", "service": "blood-bank-api", "exception": {"type": "HTTPException", "message": "403: Permission denied", "traceback": ["Traceback (most recent call last):\n", "  File \"C:\\Users\\BARTHOLOMEW\\Desktop\\donorcom\\app\\utils\\logging_config.py\", line 251, in async_wrapper\n    result = await func(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"C:\\Users\\BARTHOLOMEW\\Desktop\\donorcom\\app\\routes\\facility.py\", line 542, in update_facility\n    raise HTTPException(status_code=403, detail=\"Permission denied\")\n", "fastapi.exceptions.HTTPException: 403: Permission denied\n"]}, "function": "update_facility", "module": "app.routes.facility", "action": "function_error", "execution_time_seconds": 0.012, "status": "error", "error_type": "HTTPException", "error_message": "403: Permission denied"}
{"asctime": "2025-08-29 17:00:38,309", "levelname": "ERROR", "name": "app.routes.facility", "funcName": "async_wrapper", "lineno": 279, "message": "Error in delete_facility: 403: You do not have permission to delete this facility", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\BARTHOLOMEW\\Desktop\\donorcom\\app\\utils\\logging_config.py\", line 251, in async_wrapper\n    result = await func(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Users\\BARTHOLOMEW\\Desktop\\donorcom\\app\\routes\\facility.py\", line 731, in delete_facility\n    raise HTTPException(\n    ...<2 lines>...\n    )\nfastapi.exceptions.HTTPException: 403: You do not have permission to delete this facility", "extra_fields": {"function": "delete_facility", "module": "app.routes.facility", "action": "function_error", "execution_time_seconds": 0.0094, "status": "error", "error_type": "HTTPException", "error_message": "403: You do not have permission to delete this facility"}, "timestamp": "2025-08-29T17:00:38.314565Z", "environment": "development", "request_id": "4685f030-e8bd-41b5-88c0-c6a897abeba6", "user_id": "dfa68a60-9a4f-4d5a-a0c6-e72a03b1a3d1", "service": "blood-bank-api", "exception": {"type": "HTTPException", "message": "403: You do not have permission to delete this facility", "traceback": ["Traceback (most recent call last):\n", "  File \"C:\\Users\\BARTHOLOMEW\\Desktop\\donorcom\\app\\utils\\logging_config.py\", line 251, in async_wrapper\n    result = await func(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n", "  File \"C:\\Users\\BARTHOLOMEW\\Desktop\\donorcom\\app\\routes\\facility.py\", line 731, in delete_facility\n    raise HTTPException(\n    ...<2 lines>...\n    )\n", "fastapi.exceptions.HTTPException: 403: You do not have permission to delete this facility\n"]}, "function": "delete_facility", "module": "app.routes.facility", "action": "function_error", "execution_time_seconds": 0.0094, "status": "error", "error_type": "HTTPException", "error_message": "403: You do not have permission to delete this facility"}
